---
title: "Symposium Exploration"
author: "Chase Brewster"
date: "2022-11-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
install.packages("tidyverse")
install.packages("ggplot2")
install.packages("extrafont")
install.packages("scales")

library(tidyverse)
library(ggplot2)
library(extrafont)
library(scales)
font_import()

#Not needed so far:
install.packages("gganimate")
install.packages("zoo")
install.packages("lubridate")
install.packages("scales")
install.packages("ggthemes")
install.packages("gifski")
install.packages("png")
install.packages("extrafont")
install.packages("showtext")
install.packages("ragg")
install.packages("magick")
install.packages("gapminder")
install.packages("rsvg")
install.packages("png")
install.packages("ggimage")
install.packages("cowplot")
install.packages("systemfonts")
```

```{r}
ccc_data <- read_csv("CCC_MonthlyDataLog_Responses.csv")

ccc_data <- head(ccc_data, 378) %>% 
  select(1:65)

summary(ccc_data)

ccc_data$AT <- as.numeric(ccc_data$AT)
ccc_data$AU <- as.numeric(ccc_data$AU)
ccc_data$AV <- as.numeric(ccc_data$AV)
ccc_data$AW <- as.numeric(ccc_data$AW)
ccc_data$AX <- as.numeric(ccc_data$AX)
ccc_data$AY <- as.numeric(ccc_data$AY)
ccc_data$AZ <- as.numeric(ccc_data$AZ)
ccc_data$BA <- as.numeric(ccc_data$BA)

ccc_data <- ccc_data %>% 
  rename(
    LDPE = AT,
    HDPE = AU,
    PP = AV,
    PVC = AW,
    PS = AX,
    Nylon = AY,
    Teflon = AZ,
    PET = BA
  )

#saving data
write_csv(ccc_data, file = "ccc_data.csv")
```

```{r}
#polymer by country visualization

ccc_data_polymer <- ccc_data %>% 
  select(C, D, E, LDPE, HDPE, PP, PVC, PS, Nylon, Teflon, PET) %>% 
  mutate(total = LDPE + HDPE + PP + PVC + PS + Nylon + Teflon + PET) %>% 
  mutate(LDPE_p = (LDPE/total)*100) %>%
  mutate(HDPE_p = (HDPE/total)*100) %>%
  mutate(PP_p = (PP/total)*100) %>%
  mutate(PVC_p = (PVC/total)*100) %>%
  mutate(PS_p = (PS/total)*100) %>%
  mutate(Nylon_p = (Nylon/total)*100) %>%
  mutate(Teflon_p = (Teflon/total)*100) %>%
  mutate(PET_p = (PET/total)*100)

summary(ccc_data_polymer)

ccc_data_polymer_short <- ccc_data %>% 
  select(C, D, E, LDPE, HDPE, PP, PVC, PS, Nylon, Teflon, PET) %>% 
  mutate(total = LDPE + HDPE + PP + PVC + PS + Nylon + Teflon + PET)

polymer_summary <- ccc_data_polymer_short %>% 
  group_by(E) %>% 
  summarise(
    LDPE = sum(LDPE, na.rm = TRUE),
    HDPE = sum(HDPE, na.rm = TRUE),
    PP = sum(PP, na.rm = TRUE),
    PVC = sum(PVC, na.rm = TRUE),
    PS = sum(PS, na.rm = TRUE),
    Nylon = sum(Nylon, na.rm = TRUE),
    Teflon = sum(Teflon, na.rm = TRUE),
    PET = sum(PET, na.rm = TRUE)
  )

polymer_summary <- polymer_summary[c(2, 4:10),]

polymer_summary_p <- polymer_summary %>% 
  mutate(total = LDPE + HDPE + PP + PVC + PS + Nylon + Teflon + PET) %>% 
  mutate(LDPE_p = (LDPE/total)*100) %>%
  mutate(HDPE_p = (HDPE/total)*100) %>%
  mutate(PP_p = (PP/total)*100) %>%
  mutate(PVC_p = (PVC/total)*100) %>%
  mutate(PS_p = (PS/total)*100) %>%
  mutate(Nylon_p = (Nylon/total)*100) %>%
  mutate(Teflon_p = (Teflon/total)*100) %>%
  mutate(PET_p = (PET/total)*100)

polymer_summary <- polymer_summary[c(1,2,4,5,7,8),]

polymer_pivot <- polymer_summary %>% 
  pivot_longer(
    cols = 2:9,
    names_to = "Polymer",
    values_to = "Total"
  )

polymer_pivot <- polymer_pivot %>% 
  group_by(E)

cbPalette <- c("#56B4E9", "#E69F00", "#CC79A7", "#009E73", "#999999", "#0072B2", "#D55E00", "#F0E442")

polymer_pivot <- polymer_pivot %>% 
  rename(Country = E)

polymer_pivot$Country <- factor(polymer_pivot$Country, levels = c("Kenya", "Ecuador", "Mexico", "Indonesia", "Thailand", "Vietnam"))

polymer_graph <- ggplot(polymer_pivot, aes(fill=Polymer, y = Total, x = Country, group = Total)) +
  geom_bar(position = "fill", stat = "identity", color = 'black', size = 0.2) +
  theme_classic() +
  scale_fill_manual(values=cbPalette) +
  ggtitle("Polymer Type (%) by Country\n") +
  xlab("\nCountry") +
  ylab("% of Plastic Collected (by weight)\n") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_y_continuous(labels = percent, expand = c(0,0)) +
  annotate("text", label = "38.6%", x = 2, y = .19, color = 'white', size = 3, fontface = 'bold') +
  annotate("text", label = "39.4%", x = 4, y = .20, color = 'white', size = 3, fontface = 'bold') +
  annotate("text", label = "38.3%", x = 1, y = .19, color = 'white', size = 3, fontface = 'bold') +
  annotate("text", label = "65.9%", x = 3, y = .33, color = 'white', size = 3, fontface = 'bold') +
  annotate("text", label = "33.8%", x = 5, y = .16, color = 'white', size = 3, fontface = 'bold') +
  annotate("text", label = "54.4%", x = 6, y = .27, color = 'white', size = 3, fontface = 'bold') +
  annotate("text", label = "22.0%", x = 2, y = .50, color = 'white', size = 3, fontface = 'bold') +
  annotate("text", label = "33.0%", x = 4, y = .55, color = 'white', size = 3, fontface = 'bold') +
  annotate("text", label = "21.0%", x = 1, y = .49, color = 'white', size = 3, fontface = 'bold') +
  annotate("text", label = "31.0%", x = 3, y = .80, color = 'white', size = 3, fontface = 'bold') +
  annotate("text", label = "27.0%", x = 5, y = .48, color = 'white', size = 3, fontface = 'bold') +
  annotate("text", label = "15.8%", x = 6, y = .62, color = 'white', size = 3, fontface = 'bold') +
  annotate("text", label = "20.5%", x = 2, y = .71, color = 'white', size = 3, fontface = 'bold') +
  annotate("text", label = "25.3%", x = 4, y = .85, color = 'white', size = 3, fontface = 'bold') +
  annotate("text", label = "13.6%", x = 1, y = .66, color = 'white', size = 3, fontface = 'bold') +
  annotate("text", label = "25.2%", x = 5, y = .73, color = 'white', size = 3, fontface = 'bold') +
  annotate("text", label = "12.5%", x = 6, y = .76, color = 'white', size = 3, fontface = 'bold') +
  annotate("text", label = "10.1%", x = 1, y = .78, color = 'white', size = 3, fontface = 'bold') +
  annotate("text", label = "15.3%", x = 2, y = .89, color = 'white', size = 3, fontface = 'bold')

polymer_graph

ggsave("polymer_graph.png")
```

